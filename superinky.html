<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SuperInky Cave</n>
  <style>
    html, body { margin: 0; padding: 0; overflow: hidden; background: #111; }
    #game { display: block; margin: 0 auto; background: #222; }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="600"></canvas>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Hero frames
    const frames = ['superinky_fly1.PNG','superinky_fly2.PNG'].map(src => {
      const img = new Image(); img.src = src; return img;
    });
    let frameIndex = 0;

    // Hero properties
    const heroW = 64, heroH = 64;
    let heroX = canvas.width/4, heroY = canvas.height/2, velocity = 0;
    const gravity = 0.3, jump = -7;

    // Cave parameters
    const segmentWidth = 20;
    const caveGap = 200;
    const caveSpeed = 2;
    const segments = [];
    let offset = 0;

    // Initialize cave segments
    const segCount = Math.ceil(canvas.width/segmentWidth) + 1;
    let lastTop = 100;
    for (let i=0;i<segCount;i++) {
      segments.push(createSegment());
    }

    function createSegment() {
      // vary top between 50 and canvas.height - gap - 50
      const variation = (Math.random()-0.5)*40;
      lastTop = Math.max(50, Math.min(lastTop + variation, canvas.height - caveGap - 50));
      return { top: lastTop, bottom: lastTop + caveGap };
    }

    function updateCave() {
      offset += caveSpeed;
      if (offset >= segmentWidth) {
        offset -= segmentWidth;
        segments.shift();
        segments.push(createSegment());
      }
    }

    function updateHero() {
      velocity += gravity;
      heroY += velocity;
      if (heroY < 0) heroY = 0;
      if (heroY+heroH > canvas.height) { heroY = canvas.height-heroH; velocity=0; }
    }

    function checkCollision() {
      // Determine which segment hero is in
      const idx = Math.floor((heroX+heroW/2 + offset)/segmentWidth);
      const seg = segments[idx] || segments[0];
      if (heroY < seg.top || heroY+heroH > seg.bottom) {
        // reset game
        initGame();
      }
    }

    function drawCave() {
      for (let i=0;i<segments.length;i++) {
        const x = i*segmentWidth - offset;
        const seg = segments[i];
        // top wall
        ctx.fillStyle = '#444';
        ctx.fillRect(x,0,segmentWidth,seg.top);
        // bottom wall
        ctx.fillRect(x,seg.bottom,segmentWidth,canvas.height-seg.bottom);
      }
    }

    function drawHero() {
      const img = frames[frameIndex];
      ctx.drawImage(img, heroX, heroY, heroW, heroH);
    }

    function loop() {
      updateCave();
      updateHero();
      checkCollision();
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawCave();
      drawHero();
      requestAnimationFrame(loop);
    }

    function initGame() {
      segments.length = 0;
      lastTop = 100;
      for (let i=0;i<segCount;i++) segments.push(createSegment());
      offset = 0;
      heroY = canvas.height/2; velocity = 0;
    }

    canvas.addEventListener('click',()=>{
      velocity = jump;
      frameIndex = 1;
      setTimeout(()=>frameIndex=0,100);
    });

    initGame();
    loop();
  </script>
</body>
</html>

